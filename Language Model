# STEP 1: Install packages
!pip install -q pytesseract pillow transformers
!apt-get update -qq
!apt-get install -y tesseract-ocr libtesseract-dev

# STEP 2: Imports
import pytesseract
from PIL import Image
from transformers import pipeline
from google.colab import files
import re
import io

# STEP 3: Upload image silently
uploaded = files.upload()
filename = next(iter(uploaded))
img = Image.open(io.BytesIO(uploaded[filename]))

# STEP 4: OCR extraction
text = pytesseract.image_to_string(img).replace("\n", " ").strip()
text = text[:1024]

# STEP 5: Headline generation
summarizer = pipeline("summarization", model="facebook/bart-large-cnn")
raw = summarizer(text, max_length=20, min_length=5, do_sample=False)[0]['summary_text']

# STEP 6: Clean up .com, URLs, etc.
clean = re.sub(r'\b\w+\.com\b', '', raw)
clean = re.sub(r'https?://\S+', '', clean)
clean = re.sub(r'\s+', ' ', clean).strip()

# STEP 7: Fix headlines starting with weak verbs
weak_starts = ['will', 'is', 'are', 'was', 'were', 'has', 'have', 'had', 'can', 'could', 'may', 'might', 'shall', 'should']
tokens = clean.split()
if tokens and tokens[0].lower() in weak_starts and len(tokens) > 3:
    # Try dropping the first word and capitalizing the next
    tokens = tokens[1:]
    tokens[0] = tokens[0].capitalize()
    clean = ' '.join(tokens)

# âœ… Final output
print(f"Headline: {clean}")
